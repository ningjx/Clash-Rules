# é˜¿é‡Œäº‘ESA JustMySocks Clash é…ç½®ç”Ÿæˆå™¨

## æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨é˜¿é‡Œäº‘ESAï¼ˆEdge Serverless Applicationï¼‰è¾¹ç¼˜è®¡ç®—å¹³å°ä¸Šçš„å‡½æ•°ï¼Œæä¾›äº†APIæœåŠ¡ï¼Œç”¨äºå°†JustMySocksè´¦æˆ·çš„ä»£ç†é…ç½®è½¬æ¢ä¸ºClashå…¼å®¹æ ¼å¼çš„é…ç½®æ–‡ä»¶ã€‚å®ƒä¸Vercelç‰ˆæœ¬åŠŸèƒ½ç›¸åŒï¼Œä½†é‡‡ç”¨é˜¿é‡Œäº‘ESAçš„å‡½æ•°ç¼–å†™è§„èŒƒã€‚

## ä½¿ç”¨æ–¹æ³•

### è¯·æ±‚æ ¼å¼

```
GET /justmysocks?service=SERVICE_ID&id=SUBSCRIPTION_ID&useDomain=true&track=TRACK_ID
```

### è¯·æ±‚å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|------|------|------|------|
| `service` | string | âœ“ | JustMySocksæœåŠ¡IDï¼ˆæ ¼å¼ï¼š8ä½æ•°å­—å¦‚0000000ï¼‰ |
| `id` | string | âœ“ | è®¢é˜…GUIDæ ‡è¯†ç¬¦ |
| `useDomain` | boolean | âœ— | æ˜¯å¦ä½¿ç”¨åŸŸåä»£æ›¿IPåœ°å€ã€‚å¯é€‰å€¼ï¼š`true`ï¼ˆé»˜è®¤ï¼‰æˆ–`false` |
| `track` | string | âœ— | è¿½è¸ªæ ‡è¯†ç¬¦ï¼Œç”¨äºè¯·æ±‚è¿½è¸ªï¼ˆå¯é€‰ï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

```
https://your-esa-domain.com/justmysocks?service=0000000&id=guid-string&useDomain=true
```

### å“åº”

- **æˆåŠŸå“åº”**ï¼šè¿”å›YAMLæ ¼å¼çš„Clashé…ç½®æ–‡ä»¶ï¼ŒåŒ…å«æ‰€æœ‰è§£æçš„ä»£ç†èŠ‚ç‚¹
- **æ–‡ä»¶ä¸‹è½½**ï¼šå“åº”åŒ…å«`Content-Disposition`å¤´ï¼Œæ–‡ä»¶åæ ¼å¼ä¸º `ClashConfig-YYYY-MM-DD-HH-MM-SS.yaml`
- **æµé‡ä¿¡æ¯**ï¼šé€šè¿‡`Subscription-Userinfo`å“åº”å¤´è¿”å›æµé‡ä½¿ç”¨ç»Ÿè®¡ä¿¡æ¯

## æŠ€æœ¯ç»†èŠ‚

### å·¥ä½œæµç¨‹

1. **è¯·æ±‚éªŒè¯**
   - éªŒè¯è¯·æ±‚è·¯å¾„æ˜¯å¦ä¸º `/justmysocks`
   - æ£€æŸ¥å¿…éœ€å‚æ•° `service` å’Œ `id`

2. **å¹¶è¡Œç½‘ç»œè¯·æ±‚**
   - åŒæ—¶å‘èµ·ä¸‰ä¸ªHTTPè¯·æ±‚ï¼š
     - **æµé‡æŸ¥è¯¢**ï¼šä»JustMySocksè·å–è´¦æˆ·æµé‡ä¿¡æ¯
     - **ä¸Šæ¸¸ä»£ç†**ï¼šä»jmssub.netè·å–Base64ç¼–ç çš„ä»£ç†é…ç½®
     - **Clashæ¨¡æ¿**ï¼šä»GitHubè·å–Clashé…ç½®æ¨¡æ¿

3. **æµé‡ä¿¡æ¯å¤„ç†**
   - è§£æJSONæ ¼å¼çš„æµé‡æ•°æ®ï¼ˆå­—èŠ‚å•ä½ï¼‰
   - è‡ªåŠ¨è®¡ç®—æµé‡é‡ç½®æ—¥æœŸï¼ˆåŸºäº`bw_reset_day_of_month`ï¼‰
   - 1024è¿›åˆ¶è½¬1000è¿›åˆ¶æ¢ç®—ï¼ˆä¹˜ä»¥1.073741824ï¼‰
   - ç”ŸæˆRFCæ ‡å‡†çš„`Subscription-Userinfo`å¤´

4. **ä»£ç†é…ç½®è§£æ**
   - Base64è§£ç ä¸Šæ¸¸å“åº”
   - é€è¡Œè§£æä¸¤ç§ä»£ç†åè®®ï¼š
     - **Shadowsocks (ss://)**ï¼šæå–åŠ å¯†æ–¹å¼ã€å¯†ç ã€æœåŠ¡å™¨ã€ç«¯å£
     - **VMess**ï¼šæå–UUIDã€åŠ å¯†æ–¹å¼ã€æœåŠ¡å™¨ä¿¡æ¯ç­‰
   - ä»æœåŠ¡å™¨æ ‡è¯†ç¬¦è‡ªåŠ¨è¯†åˆ«èŠ‚ç‚¹ä½ç½®

5. **ä»£ç†åç§°æ˜ å°„**
   - æ ¹æ®é¢„è®¾æ˜ å°„è¡¨å°†æŠ€æœ¯æ ‡è¯†ç¬¦è½¬æ¢ä¸ºä¸­æ–‡åç§°
   - æ˜ å°„è¡¨ç¤ºä¾‹ï¼š
     - `c6s1` â†’ ç¾å›½1
     - `c6s4` â†’ æ—¥æœ¬
     - `c6s5` â†’ è·å…°

6. **Clashé…ç½®ç”Ÿæˆ**
   - å°†è§£æçš„ä»£ç†é…ç½®è½¬æ¢ä¸ºYAMLæ ¼å¼
   - æ›¿æ¢æ¨¡æ¿ä¸­çš„å ä½ç¬¦ï¼š
     - `{ProxyList}`ï¼šæ‰€æœ‰ä»£ç†èŠ‚ç‚¹
     - `{ProxiesNames}`ï¼šä»£ç†åç§°åˆ—è¡¨
     - `{FastestProxiesNames}`ï¼šå¿«é€Ÿæµ‹è¯•ä»£ç†åˆ—è¡¨ï¼ˆæ’é™¤é«˜å€ç‡èŠ‚ç‚¹ï¼‰
     - `{BalanceProxiesNames}`ï¼šè´Ÿè½½å‡è¡¡ä»£ç†åˆ—è¡¨ï¼ˆç¾å›½/s1/s2/s3èŠ‚ç‚¹ï¼‰

### ä¸»è¦ç‰¹æ€§

- **è¾¹ç¼˜è®¡ç®—éƒ¨ç½²**ï¼šè¿è¡Œåœ¨é˜¿é‡Œäº‘ESAå…¨çƒè¾¹ç¼˜èŠ‚ç‚¹ï¼Œä½å»¶è¿Ÿé«˜æ€§èƒ½
- **é«˜æ•ˆå¤„ç†**ï¼šä½¿ç”¨Promise.allå¹¶è¡ŒåŒ–ä¸‰ä¸ªç½‘ç»œè¯·æ±‚
- **æ€§èƒ½ç›‘æ§**ï¼šè¯¦ç»†çš„æ—¶é—´æˆ³è®°å½•å„å¤„ç†é˜¶æ®µè€—æ—¶
- **é”™è¯¯æ¢å¤**ï¼šå•ä¸ªè¯·æ±‚å¤±è´¥ä¸å½±å“å…¶ä»–åŠŸèƒ½ï¼ˆå¦‚æ— æ³•è·å–æµé‡ä¿¡æ¯ï¼Œä»è¿”å›ä»£ç†é…ç½®ï¼‰
- **CORSæ”¯æŒ**ï¼šå“åº”å¤´åŒ…å«è·¨åŸŸè®¿é—®é…ç½®
- **è¯·æ±‚è¿½è¸ª**ï¼šä¸ºæ¯ä¸ªè¯·æ±‚ç”Ÿæˆå”¯ä¸€IDå’Œæ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•å’Œç›‘æ§
- **HTTPçŠ¶æ€ç **ï¼šæ­£ç¡®ä½¿ç”¨HTTPçŠ¶æ€ç ï¼ˆ200ã€400ã€404ã€500ã€502ï¼‰

### ESAå‡½æ•°ç‰¹æ€§

- **è¯·æ±‚å¤„ç†**ï¼šä½¿ç”¨æ ‡å‡†çš„Fetch APIé£æ ¼å¤„ç†è¯·æ±‚å’Œå“åº”
- **Responseå¯¹è±¡**ï¼šè¿”å›æ ‡å‡†çš„Responseå¯¹è±¡ï¼ŒåŒ…å«çŠ¶æ€ç ã€å¤´éƒ¨å’Œå†…å®¹
- **é”™è¯¯å¤„ç†**ï¼šæ•è·æ‰€æœ‰å¼‚å¸¸ï¼Œè¿”å›ç»“æ„åŒ–çš„é”™è¯¯å“åº”
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå……åˆ†åˆ©ç”¨Promise.allè¿›è¡Œå¹¶è¡Œå¤„ç†ï¼Œé™ä½æ€»å“åº”æ—¶é—´

## ä¸šåŠ¡é€»è¾‘

### åè®®æ”¯æŒ

#### Shadowsocks (SS)
- æ ¼å¼ï¼š`ss://[åŠ å¯†:å¯†ç @æœåŠ¡å™¨:ç«¯å£]#æœåŠ¡å™¨æ ‡è¯†ç¬¦`
- è§£æåé…ç½®åŒ…æ‹¬ï¼š
  - åŠ å¯†æ–¹å¼
  - å¯†ç 
  - æœåŠ¡å™¨åœ°å€å’Œç«¯å£
  - UDPæ”¯æŒ
  - è¯ä¹¦éªŒè¯è·³è¿‡

#### VMess
- æ ¼å¼ï¼š`vmess://[Base64ç¼–ç çš„JSONé…ç½®]`
- è§£æåé…ç½®åŒ…æ‹¬ï¼š
  - æœåŠ¡å™¨(add)å’Œç«¯å£(port)
  - UUID(id) å’Œ Alter ID(aid)
  - ä¼ è¾“å±‚(net) å’Œ TLSé…ç½®
  - å…è®¸ä¸å®‰å…¨è¿æ¥

### æµé‡ç®¡ç†

- **è¿‡æœŸæ—¶é—´è®¡ç®—**ï¼šåŸºäºè´¦æˆ·çš„æœˆåº¦é‡ç½®æ—¥æœŸ
- **æµé‡ç»Ÿè®¡**ï¼š
  - ä¸Šä¼ æµé‡ï¼ˆé€šå¸¸ä¸º0ï¼‰
  - ä¸‹è½½æµé‡ï¼ˆå·²ä½¿ç”¨ï¼‰
  - æ€»æµé‡é™åˆ¶ï¼ˆæœˆåº¦é…é¢ï¼‰
  - è¿‡æœŸæ—¶é—´æˆ³ï¼ˆç§’çº§ç²¾åº¦ï¼‰

### èŠ‚ç‚¹åˆ†ç±»ç­–ç•¥

- **å®Œæ•´åˆ—è¡¨**ï¼šæ‰€æœ‰å¯ç”¨çš„ä»£ç†èŠ‚ç‚¹
- **å¿«é€Ÿæµ‹è¯•åˆ—è¡¨**ï¼šæ’é™¤é«˜å€ç‡èŠ‚ç‚¹ï¼ˆå¦‚25å€æµé‡å‡é€ŸèŠ‚ç‚¹ï¼‰
- **è´Ÿè½½å‡è¡¡åˆ—è¡¨**ï¼šä¼˜å…ˆé€‰æ‹©ç¾å›½ã€s1ã€s2ã€s3ç­‰é«˜é€ŸèŠ‚ç‚¹ï¼Œæ’é™¤å€ç‡èŠ‚ç‚¹

### æ—¥å¿—è®°å½•

æ¯ä¸ªè¯·æ±‚éƒ½ä¼šç”ŸæˆåŒ…æ‹¬ä»¥ä¸‹ä¿¡æ¯çš„å®Œæ•´æ—¥å¿—ï¼š

```
[requestId] ========== REQUEST START ==========
[requestId] Timestamp: ISO 8601 æ—¶é—´
[requestId] Parameters: è¯·æ±‚å‚æ•°
[requestId] User-Agent: ç”¨æˆ·ä»£ç†
[requestId] Parallel requests completed in Xms
[requestId] Proxy configs parsed in Xms (SS: X, VMess: Y)
[requestId] Clash config generated in Xms (Total proxies: Z)
[requestId] ========== REQUEST END ==========
[requestId] Total time: Xms
```

## ç¯å¢ƒé…ç½®

### é¡¹ç›®ç»“æ„

```
aliyunesa/
â”œâ”€â”€ package.json          # Node.jsé¡¹ç›®é…ç½®å’Œä¾èµ–
â”œâ”€â”€ esa.jsonc             # é˜¿é‡Œäº‘ESAå‡½æ•°é…ç½®
â””â”€â”€ index.js              # ä¸»å¤„ç†å‡½æ•°
```

### é…ç½®è¯´æ˜

#### esa.jsonc
- `name`ï¼šå‡½æ•°åç§°ï¼ˆjustmysocksï¼‰
- `entry`ï¼šå‡½æ•°å…¥å£æ–‡ä»¶ï¼ˆ./index.jsï¼‰
- `installCommand`ï¼šä¾èµ–å®‰è£…å‘½ä»¤
- æ— å¤–éƒ¨ä¾èµ–

#### package.json
- `name`ï¼šåŒ…åç§°
- `version`ï¼šç‰ˆæœ¬å·
- `engines`ï¼šNode.jsç‰ˆæœ¬è¦æ±‚ï¼ˆ>=18ï¼‰
- `scripts`ï¼šæ„å»ºè„šæœ¬
- æ— å¤–éƒ¨ä¾èµ–

## å“åº”ç¤ºä¾‹

### æˆåŠŸå“åº”ï¼ˆYAMLæ–‡ä»¶ï¼‰

```yaml
# æ–‡ä»¶åï¼šClashConfig-2024-01-22-15-30-45.yaml
proxies:
  - name: "ç¾å›½1"
    type: ss
    server: c6s1.justmysocks.net
    port: 443
    cipher: aes-256-gcm
    password: your-password
    udp: true
    skip-cert-verify: true

  - name: "æ—¥æœ¬"
    type: vmess
    server: c6s4.justmysocks.net
    port: 443
    uuid: your-uuid
    alterId: 0
    cipher: chacha20-poly1305
    udp: true
    tls: true
    skip-cert-verify: true
    allowInsecure: true

proxy-groups:
  - name: "ğŸŒ å¿«é€Ÿæµ‹è¯•"
    type: url-test
    proxies:
      - ç¾å›½1
      - æ—¥æœ¬
```

### æµé‡ä¿¡æ¯å¤´

```
Subscription-Userinfo: upload=0; download=5368709120; total=10737418240; expire=1708003200
```

## é”™è¯¯å¤„ç†

| çŠ¶æ€ç  | é”™è¯¯ç±»å‹ | æè¿° |
|--------|--------|------|
| 400 | Missing Parameters | ç¼ºå°‘å¿…éœ€çš„ `service` æˆ– `id` å‚æ•° |
| 404 | Not Found | è¯·æ±‚è·¯å¾„ä¸æ˜¯ `/justmysocks` |
| 502 | Upstream Error | æ— æ³•ä»JustMySocksè·å–ä»£ç†é…ç½® |
| 500 | Server Error | Base64è§£ç å¤±è´¥æˆ–å…¶ä»–æœåŠ¡å™¨é”™è¯¯ |

## æ€§èƒ½ç‰¹æ€§

- **å¹¶è¡Œå¤„ç†**ï¼šåˆ©ç”¨Promise.allåŒæ—¶å¤„ç†ä¸‰ä¸ªç½‘ç»œè¯·æ±‚
- **è¾¹ç¼˜éƒ¨ç½²**ï¼šè¿è¡Œåœ¨å…¨çƒè¾¹ç¼˜èŠ‚ç‚¹ï¼Œå“åº”æ—¶é—´æ›´çŸ­
- **æµå¼å“åº”**ï¼šç›´æ¥è¿”å›ç”Ÿæˆçš„YAMLå†…å®¹ï¼Œæ— éœ€ä¸­é—´ç¼“å­˜
- **æ—¶é—´æˆ³è®°å½•**ï¼šç²¾ç¡®è®°å½•å„é˜¶æ®µå¤„ç†æ—¶é—´ï¼Œä¾¿äºæ€§èƒ½åˆ†æ

## ä¸‰ä¸ªç‰ˆæœ¬çš„å¯¹æ¯”

| ç‰¹æ€§ | Vercel | ESA | Workers |
|------|--------|-----|---------|
| éƒ¨ç½²å¹³å° | Vercel | é˜¿é‡Œäº‘ESA | Cloudflare |
| å…¨çƒè¦†ç›– | âœ“ | âœ“ | âœ“âœ“âœ“ï¼ˆæœ€ä¼˜ï¼‰ |
| å‡½æ•°ç¼–å†™ | Node.js | Fetch API | Fetch API |
| å“åº”å¯¹è±¡ | res.status/json | Response | Response |
| æ—¥å¿—è®°å½• | å¹³å°æ—¥å¿— | å¹³å°æ—¥å¿— | Dashboard + Logpush |
| CDNé›†æˆ | âœ“ | âœ“ | âœ“âœ“ï¼ˆå†…ç½®ï¼‰ |
| DDoSé˜²æŠ¤ | âœ— | âœ— | âœ“âœ“âœ“ï¼ˆå†…ç½®ï¼‰ |
| æ€§èƒ½ | ä¸­ç­‰ | ä¸­ç­‰ | æœ€ä¼˜ |
| æˆæœ¬ | æŒ‰è°ƒç”¨æ•° | æŒ‰è°ƒç”¨æ•° | æŒ‰è°ƒç”¨æ•° |